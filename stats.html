<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="css/style1.css">
    <link rel="stylesheet" href="chartist/chartist.min.css">
    <script src="chartist/chartist.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
</head>

<body>
    <div id="floatingNav">

    </div>


    <div class="bodyDiv" id="summary">
        <h1>Stats</h1>
    </div>

    <div class="bodyDiv" id="graphs">
        <h2>graphs</h2>
        <div class="ct-chart-student">
        </div>

        <div class="ct-chartt">
        </div>

        <div class="ct-chart-age">
        </div>

        <div class="ct-chart-hours">
        </div>

        <div class="ct-chart-daily">
        </div>



        <script>
            var result;
            $.ajax({
                method: "GET", url: "fetch_data.php", async: false
            }).done(function (data) {
                result = $.parseJSON(data);
                console.log(result);
            });
            console.log(result);

            var count = result.length;

            //pie chart options
            var options = {
                labelInterpolationFnc: function (value) {
                    return value[0]
                }
            };

            var responsiveOptions = [
                ['screen and (min-width: 640px)', {
                    chartPadding: 30,
                    labelOffset: 100,
                    labelDirection: 'explode',
                    labelInterpolationFnc: function (value) {
                        return value;
                    }
                }],
                ['screen and (min-width: 1024px)', {
                    labelOffset: 80,
                    chartPadding: 20
                }]
            ];

            //student pie chart
            var studentCount = 0;
            for (var response in result) {
                if (result[response]["student"] == "yes") {
                    studentCount++;
                }
            }
            var nonStudentCount = count - studentCount;
            var studentSeries = [studentCount, nonStudentCount]
            var studentData = {
                labels: ['Students', 'Non-Students'],
                series: studentSeries
            }
            console.log(studentSeries);

            new Chartist.Pie('.ct-chart-student', studentData, options, responsiveOptions);


            //singer pie chart
            var singerCount = 0;
            for (var response in result) {
                if (result[response]["singer"] == "yes") {
                    singerCount++;
                }
            }
            var nonSingerCount = count - singerCount;
            var singerSeries = [singerCount, nonSingerCount]
            console.log(singerSeries);

            new Chartist.Pie('.ct-chartt', {
                series: singerSeries
            });

            //age pie chart
            ageSeries = [0, 0, 0, 0, 0, 0];

            for (var response in result) {
                if (result[response]["age_group"] == "15-25") {
                    ageSeries[0]++;
                } else if (result[response]["age_group"] == "26-35") {
                    ageSeries[1]++;
                } else if (result[response]["age_group"] == "36-45") {
                    ageSeries[2]++;
                } else if (result[response]["age_group"] == "46-55") {
                    ageSeries[3]++;
                } else if (result[response]["age_group"] == "56-65") {
                    ageSeries[4]++;
                } else if (result[response]["age_group"] == "65+") {
                    ageSeries[5]++;
                }
            }
            new Chartist.Pie('.ct-chart-age', {
                series: ageSeries
            });

            //Create date objects
            for (var response in result) {
                var dateObject = Date.parse(result[response]["submission_time"])
                result[response]["submission_time"] = dateObject;
            }

            //clicks per hour in the last 24 hours
            var currentDate = new Date();
            var millisecondsInHour = 3600000;
            var hourlyClicks = new Array(24).fill(0);
            for (var response in result) {
                var diff = currentDate - result[response]["submission_time"];
                var hourDiff = parseInt(diff / millisecondsInHour);
                if (hourDiff < 25) {
                    hourlyClicks[hourDiff]++;
                }
            }
            console.log(hourlyClicks);
            hourlyClicks.reverse();
            var hourlyData = {
                labels: ['24', '23', '22', '21', '20', '19', '18', '17', '16', '15', '14', '13',
                    '12', '11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1'],
                series: [hourlyClicks]

            };
            new Chartist.Bar('.ct-chart-hours', hourlyData);

            //clicks per day in the last week
            var currentDate = new Date();
            var millisecondsInDay = 3600000 * 24;
            var dailyClicks = new Array(7).fill(0);
            for (var response in result) {
                var diff = currentDate - result[response]["submission_time"];
                var dayDiff = parseInt(diff / millisecondsInDay);
                if (dayDiff < 8) {
                    dailyClicks[dayDiff]++;
                }
            }
            console.log(dailyClicks);
            dailyClicks.reverse();
            var dailyData = {
                labels: ['7', '6', '5', '4', '3', '2', '1'],
                series: [dailyClicks]

            };
            new Chartist.Bar('.ct-chart-daily', dailyData);


        </script>

</body>

<footer>
</footer>

</html>